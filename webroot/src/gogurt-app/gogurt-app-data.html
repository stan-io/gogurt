<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="gogurt-app-data">
    <script>
        (function() {
            var instances = [];
            var vars = Object.create(Polymer.Base);

            Polymer({
                is: "gogurt-app-data",
                properties: {
                    data: {
                        type: Object,
                        notify: true,
                        readonly: false,
                        value: {},
                        observer: '_dataChanged_'
                    },
                    key: String
                },
                created: function() {
                    key = this.getAttribute("key");
                    if (key) {
                        instances.push({key: key, instance: this});
                    }
                },
                detached: function() {
                    key = this.getAttribute("key");
                    var index = instances.indexOf({key: key, instance: this});
                    if (index >= 0) {
                        instances.splice(index, 1);
                    }
                },
                _dataChanged_: function(newValue, oldValue) {
                    key = this.getAttribute("key");
                    if (key) {
                        vars.set(key, newValue);
                        for (var i = 0; i < instances.length; ++ i) {
                            if (instances[i].key == key) {
                                instances[i].instance.notifyPath("data", newValue);
                            }
                        }
                    }
                }
            })
        })();
    </script>
</dom-module>